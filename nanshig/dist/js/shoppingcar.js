"use strict";$(function(){function x(){var n=[];return $(".checked input").each(function(t,e){$(e).prop("checked")&&n.push(t)}),n}$("h1").on("click",function(){location.href="../index.html"}),$("#footer").load("footer_area.html");var t=getCookie("username");ajax({type:"get",url:"../api/getcars.php",data:{uname:t},success:function(t){if("false"!=t){var e=JSON.parse(t),n=e.list.map(function(t){return t.sname});console.log(unique(n));var a=e.list,c="",i=!0,r=!1,o=void 0;try{for(var l,s=n[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var p=l.value;c+="<tr><td class='shopname' colspan=\"20\">商品来源："+p+"</td></tr>";var u=p,d=!0,h=!1,f=void 0;try{for(var m,g=a[Symbol.iterator]();!(d=(m=g.next()).done);d=!0){var k=m.value;k.sname==u&&(c+='<tr data-id="'+k.id+'">\n                            <td class="check checked"><input type="checkbox" data-id="'+k.id+'"></td>\n                            <td class="img"><img src="'+k.gimg+'" alt=""></td>\n                            <td class="title">\n                                <p>'+k.title+"<span> "+k.size+" "+k.color+'</span></p>\n                            </td>\n                            <td class="price">'+k.price+'</td>\n                            <td class="nums">\n                                <input type="button" value="-" class="down">\n                                <input type="text" value="'+k.num+'" class="gnum">\n                                <input type="button" value="+" class="up">\n                            </td>\n                            <td class="subtotal subtotalprice">'+k.num*k.price+'</td>\n                            <td><a href="javascript:void(0)" class="del">删除</a></td>\n                        </tr>')}}catch(t){h=!0,f=t}finally{try{!d&&g.return&&g.return()}finally{if(h)throw f}}}}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}$("tbody").html(c),$("#money").text(0)}function v(t,e){ajax({type:"get",url:"../api/gupdate.php",data:{id:t,num:e},success:function(){}})}function y(t,e){var n=$(t).parent().parent().find(".price").text()*e;$(t).parent().parent().find(".subtotal").text(n)}function b(){var t=x(),e=0;t.forEach(function(t){e+=1*$(".subtotalprice").eq(t).text()}),$("#money").text(e)}$("#allcheck").click(function(){var t=$("#allcheck").prop("checked");$(".check input").prop("checked",t),b()}),$("tbody").on("click",".checked input",function(){$(".checked input").length==$(".checked input:checked").length?$("#allcheck").prop("checked",!0):$("#allcheck").prop("checked",!1),b()}),$("tbody").on("click",".del",function(){var t=this.parentNode.parentNode.getAttribute("data-id"),e=this;ajax({type:"get",url:"../api/del.php",data:{id:t},success:function(t){"success"==t?e.parentNode.parentNode.remove():alert("失败了")}}),b()}),$("tbody").on("click",".up",function(){var t=1*$(this).parent().find(".gnum").val();t<10?($(this).parent().find(".gnum").val(1+t),v($(this).parent().parent().attr("data-id"),1+t),y(this,1+t)):alert("超出库存");b()}),$("tbody").on("click",".down",function(){var t=1*$(this).parent().find(".gnum").val();1<t?($(this).parent().find(".gnum").val(t-1),v($(this).parent().parent().attr("data-id"),t-1),y(this,t-1)):alert("超出库存");b()})}}),$(".golistpage").eq(0).on("click",function(){location.href="listpage.html?clothes"}),$(".golistpage").eq(1).on("click",function(){location.href="listpage.html?shoes"}),$(".golistpage").eq(2).on("click",function(){location.href="listpage.html?suit"}),$("#paybtn").on("click",function(){arr=x();var e=0,n="";arr.forEach(function(t){e+=1*$(".subtotalprice").eq(t).text(),n+='\n            <p>\n                <img src="'+$(".img img").eq(t).attr("src")+'" alt="">\n                <span>'+$(".title p").eq(t).text()+"</span>\n                <span>￥"+$(".subtotalprice").eq(t).text()+"</span>\n            </p>",ajax({type:"get",url:"../api/del",data:{id:$(".img").eq(t).parent().attr("data-id")},success:function(t){"false"==t&&alert("出现异常")}})}),n+='<p id="zongjia">结算成功：￥'+e+"</p>",$("#jiesuan").html(n),$("#jiesuan").css("display","block"),setTimeout(function(){location.reload()},3e3)})});